<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications - SLRail Express</title>
    <link rel="stylesheet" href="../CSS/notification.css">
</head>
<body>

<header class="header">
    <div class="logo-container">
        <div class="train-icon"></div>
        <h1>SLRailE</h1>
    </div>
    <nav class="navigation">
        <ul>
            <li><a href="../../IT24101525/HTML/userprofile.html">My Profile</a></li>
            <li><a href="../../IT24102460/HTML/mem_shedule.html">Schedule</a></li>
            <li><a href="../../IT24101558/HTML/bookinghistory.html">Booking History</a></li>
            <li><a href="#" class="active">Notifications</a></li>
            <li><a href="../../IT24101009/HTML/mem-feedback.html">Feedback</a></li>
            <li><a href="../../IT24101525/HTML/usersettings.html">Settings</a></li>
            <li><a href="../../IT24101208/HTML/member-logout.html">Logout</a></li>
        </ul>
    </nav>
</header>

<main class="main-content">
    <section class="notifications-header">
        <h1>Notifications</h1>
        <p>You have <strong id="unread-count">0 unread</strong> messages</p>
    </section>

    <section class="notifications-list" id="notifications-list">
        <!-- Notifications will be loaded dynamically -->
        <div class="loading">Loading notifications...</div>
    </section>

    <div class="notifications-actions">
        <button id="mark-all-read" class="action-btn">Mark All as Read</button>
        <button id="clear-all" class="action-btn danger">Clear All</button>
    </div>
</main>

<footer class="footer">
    <div class="footer-content">
        <div class="footer-logo">
            <h3>SLRailE</h3>
            <p>SLRailE is your all-in-one digital companion for train travel across Sri Lanka. Designed to make journeys smoother and more convenient, SLRailE provides real-time train schedules, route planning, and live updates on arrivals, departures, and delays.</p>
            <p>Whether you're a daily commuter or a tourist exploring the island's breathtaking scenery, SLRailE is your essential partner for smart and seamless railway travel.</p>
        </div>
        <div class="footer-links">
            <div class="link-column">
                <h4>Services</h4>
                <ul>
                    <li><a href="#">Schedule</a></li>
                    <li><a href="#">Tickets</a></li>
                    <li><a href="#">Reservations</a></li>
                    <li><a href="#">Luggage</a></li>
                </ul>
            </div>
            <div class="link-column">
                <h4>Information</h4>
                <ul>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Careers</a></li>
                    <li><a href="#">News</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </div>
            <div class="link-column">
                <h4>Legal</h4>
                <ul>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms of Service</a></li>
                    <li><a href="#">Cookie Policy</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="copyright">
        <p>&copy; 2025 SLRailE. All rights reserved.</p>
    </div>
</footer>

<script>
    // API Base URL
    const API_BASE_URL = 'http://localhost:8080/api/passenger/notifications';
    
    // Load notifications on page load
    document.addEventListener('DOMContentLoaded', function() {
        loadNotifications();
        setupEventListeners();
    });

    // Load notifications from API
    async function loadNotifications() {
        try {
            const response = await fetch(API_BASE_URL);
            if (response.ok) {
                const notifications = await response.json();
                displayNotifications(notifications);
                updateUnreadCount(notifications.length);
            } else {
                console.error('Failed to load notifications');
                showError('Failed to load notifications');
            }
        } catch (error) {
            console.error('Error loading notifications:', error);
            showError('Error loading notifications');
        }
    }

    // Display notifications in the UI
    function displayNotifications(notifications) {
        const notificationList = document.getElementById('notifications-list');
        notificationList.innerHTML = '';

        if (notifications.length === 0) {
            notificationList.innerHTML = '<p class="no-notifications">No notifications to show.</p>';
            return;
        }

        notifications.forEach((notification, index) => {
            const notificationElement = createNotificationElement(notification, index);
            notificationList.appendChild(notificationElement);
        });
    }

    // Create notification element
    function createNotificationElement(notification, index) {
        const div = document.createElement('div');
        div.className = 'notification unread';
        div.dataset.id = notification.id;

        // Get appropriate icon based on notification type
        const iconSvg = getNotificationIcon(notification.type);

        // Format time ago
        const timeAgo = getTimeAgo(notification.createdAt);

        div.innerHTML = `
            <div class="notification-icon">
                ${iconSvg}
            </div>
            <div class="notification-content">
                <p>${notification.message}</p>
                <small>${timeAgo}</small>
            </div>
            <button class="mark-read">âœ•</button>
        `;

        // Add animation delay
        div.style.opacity = '0';
        div.style.transform = 'translateY(15px)';
        setTimeout(() => {
            div.style.opacity = '1';
            div.style.transform = 'translateY(0)';
            div.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
        }, 100 + index * 100);

        return div;
    }

    // Get appropriate icon for notification type
    function getNotificationIcon(type) {
        const icons = {
            'SYSTEM': `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>`,
            'ALERT': `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
                <path d="M2 8v8"></path>
                <path d="M2 12h16"></path>
            </svg>`,
            'MAINTENANCE': `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.07V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>`,
            'UPDATE': `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="3" y1="9" x2="21" y2="9"></line>
                <line x1="9" y1="21" x2="9" y2="9"></line>
            </svg>`,
            'INFO': `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2v4"></path>
                <path d="m16.24 7.76-2.12 2.12"></path>
                <path d="M18.5 12h-4"></path>
                <path d="m16.24 16.24-2.12-2.12"></path>
                <path d="M12 18v4"></path>
                <path d="m4.93 4.93 2.12 2.12"></path>
                <path d="M2 12h4"></path>
                <path d="m4.93 19.07 2.12-2.12"></path>
            </svg>`
        };
        return icons[type] || icons['INFO'];
    }

    // Get time ago string
    function getTimeAgo(dateString) {
        const now = new Date();
        const date = new Date(dateString);
        const diffInSeconds = Math.floor((now - date) / 1000);

        if (diffInSeconds < 60) {
            return 'Just now';
        } else if (diffInSeconds < 3600) {
            const minutes = Math.floor(diffInSeconds / 60);
            return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
        } else if (diffInSeconds < 86400) {
            const hours = Math.floor(diffInSeconds / 3600);
            return `${hours} hour${hours > 1 ? 's' : ''} ago`;
        } else {
            const days = Math.floor(diffInSeconds / 86400);
            return `${days} day${days > 1 ? 's' : ''} ago`;
        }
    }

    // Update unread count
    function updateUnreadCount(count) {
        const unreadCountElement = document.getElementById('unread-count');
        unreadCountElement.textContent = `${count} unread`;
    }

    // Setup event listeners
    function setupEventListeners() {
        // Mark all as read
        document.getElementById('mark-all-read').addEventListener('click', function() {
            document.querySelectorAll('.notification.unread').forEach(notif => {
                notif.classList.remove('unread');
                notif.classList.add('read');
                notif.style.opacity = '0.6';
            });
            updateUnreadCount(0);
        });

        // Clear all notifications
        document.getElementById('clear-all').addEventListener('click', function() {
            if (confirm('Are you sure you want to clear all notifications?')) {
                document.getElementById('notifications-list').innerHTML = '<p class="no-notifications">No notifications to show.</p>';
                updateUnreadCount(0);
            }
        });

        // Delegate event listener for mark as read buttons
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('mark-read')) {
                const notification = event.target.closest('.notification');
                notification.classList.remove('unread');
                notification.classList.add('read');
                notification.style.opacity = '0.6';
                
                // Update unread count
                const unreadCount = document.querySelectorAll('.notification.unread').length;
                updateUnreadCount(unreadCount);
            }
        });
    }

    // Show error message
    function showError(message) {
        const notificationList = document.getElementById('notifications-list');
        notificationList.innerHTML = `<p class="error-message">${message}</p>`;
    }
</script>

</body>
</html>