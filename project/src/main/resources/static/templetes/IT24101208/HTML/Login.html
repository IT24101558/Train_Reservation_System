<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login - SLRailE</title>
  <link rel="stylesheet" href="../CSS/login.css" />
</head>
<body>
<header class="header">
  <div class="logo-container">
    <div class="train-icon"></div>
    <h1>SLRailE</h1>
  </div>
  <nav class="navigation">
    <ul>
      <li><a href="../../IT24101009/HTML/index.html">Home</a></li>
      <li><a href="../HTML/gallery.html">Gallery</a></li>
      <li><a href="../HTML/guest_shedule.html">Schedule</a></li>
      <li><a href="../HTML/signup.html">SignUp</a></li>
      <li><a href="../../IT24101009/HTML/contact.html">Contact Us</a></li>
      <li><a href="../HTML/about.html">About Us</a></li>
    </ul>
  </nav>
</header>

<main class="main-content">
  <section class="login-container">
    <div class="login-form">
      <h2>Welcome Back</h2>
      <p>Log in to access your SLRailE account and manage your journeys.</p>

      <div id="loginForm">
        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" name="email" placeholder="Enter your email" required />
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" placeholder="Enter your password" required />
        </div>

        <div class="form-options">
          <div class="checkbox">
            <input type="checkbox" id="remember" name="remember" />
            <label for="remember">Remember me</label>
          </div>
          <a href="../HTML/forgot-password.html" class="forgot-link">Forgot password?</a>
        </div>

        <button type="button" id="btnLogin" class="btn-login">Log In</button>
      </div>

      <div class="signup-link">
        <p>Don't have an account? <a href="../HTML/Register.html">Sign Up</a> <br> Back to  <a href="../../IT24101009/HTML/index.html">Home</a></p>
      </div>
    </div>

    <div class="login-image">
      <img src="../../IT24102460/images/Ride12.jpg" alt="Train journey at sunset" />
    </div>
  </section>
</main>

<footer class="footer">
  <div class="footer-content">
    <div class="footer-logo">
      <h3>SLRailE</h3>
      <p>SLRailE is your all-in-one digital companion for train travel across Sri Lanka. Designed to make journeys smoother and more convenient, SLRailE provides real-time train schedules, route planning, and live updates on arrivals, departures, and delays.</p>
      <p>Whether you're a daily commuter or a tourist exploring the island's breathtaking scenery, SLRailE is your essential partner for smart and seamless railway travel.</p>
    </div>
    <div class="footer-links">
      <div class="link-column">
        <h4>Services</h4>
        <ul>
          <li><a href="#">Schedule</a></li>
          <li><a href="#">Tickets</a></li>
          <li><a href="#">Reservations</a></li>
          <li><a href="#">Luggage</a></li>
        </ul>
      </div>
      <div class="link-column">
        <h4>Information</h4>
        <ul>
          <li><a href="#">About Us</a></li>
          <li><a href="#">Careers</a></li>
          <li><a href="#">News</a></li>
          <li><a href="#">Contact</a></li>
        </ul>
      </div>
      <div class="link-column">
        <h4>Legal</h4>
        <ul>
          <li><a href="#">Privacy Policy</a></li>
          <li><a href="#">Terms of Service</a></li>
          <li><a href="#">Cookie Policy</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="copyright">
    <p>&copy; 2025 SLRailE. All rights reserved.</p>
  </div>
</footer>

<script>
  // Login via backend and redirect by role
  document.getElementById("btnLogin").addEventListener("click", async function(e) {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    if (!email || !password) {
      alert("Please fill in both fields.");
      return;
    }

    try {
      const resp = await fetch(window.location.origin + "/api/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });
      const data = await resp.json();
      if (resp.ok && data.success) {
        // store logged-in email for profile fetch
        try { localStorage.setItem("slraile_email", email); } catch(_) {}

        // Prefetch profile and cache for User Settings prefill
        try {
          const prof = await fetch(window.location.origin + "/api/auth/profile?email=" + encodeURIComponent(email));
          if (prof.ok) {
            const profile = await prof.json();
            try { localStorage.setItem('slraile_user', JSON.stringify(profile)); } catch(_) {}
          }
        } catch(_) {}

        if (data.role === "ADMIN") {
          window.location.href = window.location.origin + "/templetes/IT24101009/HTML/admin.html";
        } else {
          // Go to User Settings to edit details right away
          window.location.href = window.location.origin + "/templetes/IT24101525/HTML/usersettings.html";
        }
      } else {
        alert(data.message || "Invalid credentials");
      }
    } catch (err) {
      alert("Network error. Please try again.");
    }
  });

  // Prevent Enter key from submitting the form
  (function(){
    const form = document.getElementById("loginForm");
    form.addEventListener("keydown", function(ev){
      if (ev.key === "Enter") {
        ev.preventDefault();
      }
    });
    // Absolute prevention in capture phase for any stray <form>
    document.addEventListener("submit", function(ev){
      ev.preventDefault();
      ev.stopImmediatePropagation();
      return false;
    }, true);
    if (window.history && window.history.replaceState) {
      window.history.replaceState(null, document.title, window.location.href);
    }
  })();
</script>
</body>
</html>