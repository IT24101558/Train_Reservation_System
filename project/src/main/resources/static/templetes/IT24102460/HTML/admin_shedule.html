<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Schedule Management - SLRailE</title>
    <link rel="stylesheet" href="../CSS/admin_shedule.css">
</head>
<body>
<header class="header">
    <div class="logo-container">
        <div class="train-icon"></div>
        <h1>SLRailE</h1>
    </div>
    <nav class="navigation">
        <ul>
            <li><a href="../../IT24101009/HTML/admin.html">Dashboard</a></li>
            <li><a href="#" class="active">Schedule</a></li>
            <li><a href="../../IT24101525/HTML/adminseatmanegement.html">Seat Allocation</a></li>
            <li><a href="../../IT24300073/HTML/admin-profile.html">My Profile</a></li>
            <li><a href="../../IT24101009/HTML/admin-feedback.html">Feedback</a></li>
        </ul>
    </nav>
</header>

<main class="main-content">
    <section class="hero">
        <h1>Train Schedule Management</h1>
        <p class="subtitle">Manage train schedules, routes, and pricing</p>
    </section>

    <section class="controls-container">
        <div class="search-filter">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search by train, route, or station...">
                <button id="search-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                </button>
            </div>

            <div class="filters">
                <select id="route-filter">
                    <option value="">All Routes</option>
                    <option value="central-north">Central to North</option>
                    <option value="central-south">Central to South</option>
                    <option value="central-east">Central to East</option>
                    <option value="central-west">Central to West</option>
                </select>
                <select id="status-filter">
                    <option value="">All Status</option>
                    <option value="active">Active</option>
                    <option value="delayed">Delayed</option>
                    <option value="canceled">Canceled</option>
                    <option value="maintenance">Maintenance</option>
                </select>
                <select id="date-filter">
                    <option value="">All Dates</option>
                    <option value="today">Today</option>
                    <option value="tomorrow">Tomorrow</option>
                    <option value="this-week">This Week</option>
                    <option value="next-week">Next Week</option>
                </select>
            </div>
        </div>

        <button id="add-schedule-btn" class="primary-btn">
            <span>➕</span> Add New Schedule
        </button>
    </section>

    <section class="schedule-container">
        <div class="schedule-header">
            <h2>Current Schedules</h2>
            <div class="schedule-stats">
                <div class="stat">
                    <span class="value">24</span>
                    <span class="label">Active Trains</span>
                </div>
                <div class="stat">
                    <span class="value">3</span>
                    <span class="label">Delayed</span>
                </div>
                <div class="stat">
                    <span class="value">1</span>
                    <span class="label">Canceled</span>
                </div>
            </div>
        </div>

        <div class="schedule-table-container">
            <table class="schedule-table">
                <thead>
                <tr>
                    <th>Train</th>
                    <th>Route</th>
                    <th>Departure</th>
                    <th>Arrival</th>
                    <th>Duration</th>
                    <th>Platform</th>
                    <th>Status</th>
                    <th>Price</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody id="schedule-body">
                <tr data-schedule-id="1">
                    <td class="train-name">Express 101</td>
                    <td class="route">Central - South</td>
                    <td class="departure">06:30</td>
                    <td class="arrival">08:15</td>
                    <td class="duration">1h 45m</td>
                    <td class="platform">3</td>
                    <td class="status status-active">Active</td>
                    <td class="price">$45 / $75 / $120</td>
                    <td class="actions">
                        <button class="edit-btn" data-action="edit" title="Edit Schedule">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                            </svg>
                        </button>
                        <button class="delete-btn" data-action="delete" title="Delete Schedule">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1 1v1h4V2a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1v1zM4.5 3V2h7v1h-7z"/>
                            </svg>
                        </button>
                        <button class="duplicate-btn" data-action="duplicate" title="Duplicate Schedule">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.616l-6.718 3.12a2.5 2.5 0 0 1 0 3.268l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.268l6.718-3.12A2.5 2.5 0 0 1 11 2.5zm-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z"/>
                            </svg>
                        </button>
                    </td>
                </tr>
                <tr data-schedule-id="2">
                    <td class="train-name">Regional 205</td>
                    <td class="route">Central - North</td>
                    <td class="departure">07:15</td>
                    <td class="arrival">09:30</td>
                    <td class="duration">2h 15m</td>
                    <td class="platform">5</td>
                    <td class="status status-delayed">Delayed</td>
                    <td class="price">$32 / $58 / $95</td>
                    <td class="actions">
                        <button class="edit-btn" data-action="edit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                            </svg>
                        </button>
                        <button class="delete-btn" data-action="delete">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1 1v1h4V2a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1v1zM4.5 3V2h7v1h-7z"/>
                            </svg>
                        </button>
                        <button class="duplicate-btn" data-action="duplicate">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.616l-6.718 3.12a2.5 2.5 0 0 1 0 3.268l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.268l6.718-3.12A2.5 2.5 0 0 1 11 2.5zm-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z"/>
                            </svg>
                        </button>
                    </td>
                </tr>
                <tr data-schedule-id="3">
                    <td class="train-name">Express 103</td>
                    <td class="route">Central - South</td>
                    <td class="departure">08:45</td>
                    <td class="arrival">10:30</td>
                    <td class="duration">1h 45m</td>
                    <td class="platform">2</td>
                    <td class="status status-active">Active</td>
                    <td class="price">$48 / $80 / $125</td>
                    <td class="actions">
                        <button class="edit-btn" data-action="edit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                            </svg>
                        </button>
                        <button class="delete-btn" data-action="delete">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1 1v1h4V2a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1v1zM4.5 3V2h7v1h-7z"/>
                            </svg>
                        </button>
                        <button class="duplicate-btn" data-action="duplicate">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.616l-6.718 3.12a2.5 2.5 0 0 1 0 3.268l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.268l6.718-3.12A2.5 2.5 0 0 1 11 2.5zm-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z"/>
                            </svg>
                        </button>
                    </td>
                </tr>
                <tr data-schedule-id="4">
                    <td class="train-name">Commuter 301</td>
                    <td class="route">Central - East</td>
                    <td class="departure">09:20</td>
                    <td class="arrival">11:05</td>
                    <td class="duration">1h 45m</td>
                    <td class="platform">4</td>
                    <td class="status status-active">Active</td>
                    <td class="price">$38 / $65 / $100</td>
                    <td class="actions">
                        <button class="edit-btn" data-action="edit">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                            </svg>
                        </button>
                        <button class="delete-btn" data-action="delete">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1 1v1h4V2a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1v1zM4.5 3V2h7v1h-7z"/>
                            </svg>
                        </button>
                        <button class="duplicate-btn" data-action="duplicate">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.616l-6.718 3.12a2.5 2.5 0 0 1 0 3.268l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.268l6.718-3.12A2.5 2.5 0 0 1 11 2.5zm-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z"/>
                            </svg>
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>

    <div id="schedule-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modal-title">Add New Schedule</h2>

            <form id="schedule-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="train-name">Train Name *</label>
                        <input type="text" id="train-name" name="train-name" required>
                        <span class="error-message">Please enter a train name</span>
                    </div>

                    <div class="form-group">
                        <label for="train-type">Train Type *</label>
                        <select id="train-type" name="train-type" required>
                            <option value="">Select train type</option>
                            <option value="express">Express</option>
                            <option value="regional">Regional</option>
                            <option value="commuter">Commuter</option>
                            <option value="high-speed">High-Speed</option>
                        </select>
                        <span class="error-message">Please select a train type</span>
                    </div>

                    <div class="form-group">
                        <label for="route-from">Route From *</label>
                        <input type="text" id="route-from" placeholder="Enter departure station" required>
                        <span class="error-message">Please enter departure station</span>
                    </div>

                    <div class="form-group">
                        <label for="route-to">Route To *</label>
                        <input type="text" id="route-to" placeholder="Enter destination station" required>
                        <span class="error-message">Please enter destination station</span>
                    </div>

                    <div class="form-group">
                        <label for="departure-time">Departure Time *</label>
                        <input type="time" id="departure-time" name="departure-time" required>
                        <span class="error-message">Please enter departure time</span>
                    </div>

                    <div class="form-group">
                        <label for="arrival-time">Arrival Time *</label>
                        <input type="time" id="arrival-time" name="arrival-time" required>
                        <span class="error-message">Please enter arrival time</span>
                    </div>

                    <div class="form-group">
                        <label for="platform">Platform *</label>
                        <input type="number" id="platform" name="platform" min="1" max="15" required>
                        <span class="error-message">Please enter platform number (1-15)</span>
                    </div>

                    <div class="form-group">
                        <label for="status">Status *</label>
                        <select id="status" name="status" required>
                            <option value="active">Active</option>
                            <option value="delayed">Delayed</option>
                            <option value="canceled">Canceled</option>
                            <option value="maintenance">Maintenance</option>
                        </select>
                    </div>
                </div>

                <div class="pricing-section">
                    <h3>Pricing</h3>
                    <div class="pricing-container">
                        <div class="pricing-container">
                            <div class="form-group">
                                <label for="economy-price">Economy Class Price *</label>
                                <input type="number" id="economy-price" class="pricing-input" placeholder="Rs.0.00" step="0.01" required>
                                <span class="error-message">Enter a valid price</span>
                            </div>
                            <div class="form-group">
                                <label for="business-price">Business Class Price *</label>
                                <input type="number" id="business-price" class="pricing-input" placeholder="Rs.0.00" step="0.01" required>
                                <span class="error-message">Enter a valid price</span>
                            </div>
                            <div class="form-group">
                                <label for="first-price">First Class Price *</label>
                                <input type="number" id="first-price" class="pricing-input" placeholder="Rs.0.00" step="0.01" required>
                                <span class="error-message">Enter a valid price</span>
                            </div>
                        </div>

                    </div>

                    <div class="form-group">
                        <label for="notes">Additional Notes</label>
                        <textarea id="notes" name="notes" rows="3" placeholder="Any special instructions or notes..."></textarea>
                    </div>

                    <div class="modal-actions">
                        <a id="edit-seat-management-link" href="../../IT24101525/HTML/adminseatmanegement.html">
                            <button type="button" class="seat-btn">Edit Seat Management</button>
                        </a>
                        <button type="button" class="cancel-btn">Cancel</button>
                        <button type="submit" class="save-btn">Save Schedule</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="warning-icon">⚠️</div>
            <h2>Confirm Deletion</h2>
            <p>Are you sure you want to delete this train schedule? This action cannot be undone.</p>
            <p class="delete-warning">Train: <span id="delete-train-name">Express 101</span></p>
            <p class="delete-warning">Route: <span id="delete-route">Central - South</span></p>

            <div class="modal-actions">
                <button type="button" class="cancel-btn">Cancel</button>
                <button type="button" class="danger-btn confirm-delete-btn">Delete Permanently</button>
            </div>
        </div>
    </div>
</main>

<footer class="footer">
    <div class="footer-content">
        <div class="footer-logo">
            <h3>SLRailE</h3>
            <p>SLRailE is your all-in-one digital companion for train travel across Sri Lanka. Designed to make journeys smoother and more convenient, SLRailE provides real-time train schedules, route planning, and live updates on arrivals, departures, and delays.</p>
            <p>Whether you're a daily commuter or a tourist exploring the island's breathtaking scenery, SLRailE is your essential partner for smart and seamless railway travel.</p>
        </div>
        <div class="footer-links">
            <div class="link-column">
                <h4>Admin Tools</h4>
                <ul>
                    <li><a href="#">Dashboard</a></li>
                    <li><a href="#">Schedule</a></li>
                    <li><a href="#">Users</a></li>
                    <li><a href="#">Reports</a></li>
                </ul>
            </div>
            <div class="link-column">
                <h4>Information</h4>
                <ul>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Careers</a></li>
                    <li><a href="#">News</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </div>
            <div class="link-column">
                <h4>Legal</h4>
                <ul>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms of Service</a></li>
                    <li><a href="#">Cookie Policy</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="copyright">
        <p>&copy; 2025 SLRailE. All rights reserved.</p>
    </div>
</footer>

<script>
    // --- START: ORIGINAL SCRIPT (NO CHANGES) ---
    // DOM elements
    const scheduleBody = document.getElementById('schedule-body');
    const addScheduleBtn = document.getElementById('add-schedule-btn');
    const scheduleModal = document.getElementById('schedule-modal');
    const deleteModal = document.getElementById('delete-modal');
    const successNotification = document.getElementById('success-notification');
    const errorNotification = document.getElementById('error-notification');
    const closeModal = document.querySelector('#schedule-modal .close');
    const closeDeleteModal = document.querySelector('#delete-modal .close');
    const scheduleForm = document.getElementById('schedule-form');
    const modalTitle = document.getElementById('modal-title');
    const cancelBtns = document.querySelectorAll('.cancel-btn');
    const saveBtn = document.querySelector('.save-btn');
    const confirmDeleteBtn = document.querySelector('.confirm-delete-btn');

    // Current schedule being edited
    let currentScheduleId = null;
    let currentAction = null; // 'add' or 'edit'

    // Open Add Schedule modal
    addScheduleBtn.addEventListener('click', function() {
        currentAction = 'add';
        currentScheduleId = null;
        modalTitle.textContent = 'Add New Schedule';
        scheduleForm.reset();
        scheduleModal.style.display = 'flex';
    });

    // Open Edit Schedule modal
    document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const row = this.closest('tr');
            currentAction = 'edit';
            currentScheduleId = row.dataset.scheduleId;
            modalTitle.textContent = 'Edit Schedule';

            // Populate form with current values
            document.getElementById('train-name').value = row.querySelector('.train-name').textContent;
            document.getElementById('route-from').value = getFromStation(row.querySelector('.route').textContent);
            document.getElementById('route-to').value = getToStation(row.querySelector('.route').textContent);
            document.getElementById('departure-time').value = timeTo24Hour(row.querySelector('.departure').textContent);
            document.getElementById('arrival-time').value = timeTo24Hour(row.querySelector('.arrival').textContent);
            document.getElementById('platform').value = row.querySelector('.platform').textContent;
            document.getElementById('status').value = getStatusValue(row.querySelector('.status').classList);

            // Extract prices from the price cell
            const priceText = row.querySelector('.price').textContent;
            const prices = priceText.split(' / ');
            document.getElementById('economy-price').value = prices[0].replace('$', '');
            document.getElementById('business-price').value = prices[1].replace('$', '');
            document.getElementById('first-price').value = prices[2].replace('$', '');

            // Set train type based on train name
            const trainName = row.querySelector('.train-name').textContent;
            if (trainName.includes('Express')) {
                document.getElementById('train-type').value = 'express';
            } else if (trainName.includes('Regional')) {
                document.getElementById('train-type').value = 'regional';
            } else if (trainName.includes('Commuter')) {
                document.getElementById('train-type').value = 'commuter';
            } else {
                document.getElementById('train-type').value = 'high-speed';
            }

            scheduleModal.style.display = 'flex';
        });
    });

    // Helper functions
    function getFromStation(route) {
        return route.split(' - ')[0].trim();
    }

    function getToStation(route) {
        return route.split(' - ')[1].trim();
    }

    function timeTo24Hour(time) {
        return time;
    }

    function getStatusValue(classList) {
        if (classList.contains('status-active')) return 'active';
        if (classList.contains('status-delayed')) return 'delayed';
        if (classList.contains('status-canceled')) return 'canceled';
        return 'maintenance';
    }
    // ... (rest of the original script up to the DOMContentLoaded part)
    // The following code is simplified for brevity but assumes your existing functions
    // (createScheduleRow, updateScheduleRow, etc.) are present and correct.
    closeModal.addEventListener('click', () => { scheduleModal.style.display = 'none'; });
    closeDeleteModal.addEventListener('click', () => { deleteModal.style.display = 'none'; });
    cancelBtns.forEach(btn => { btn.addEventListener('click', function() {
        scheduleModal.style.display = 'none';
        deleteModal.style.display = 'none';
    }); });
    window.addEventListener('click', function(event) {
        if (event.target === scheduleModal) { scheduleModal.style.display = 'none'; }
        if (event.target === deleteModal) { deleteModal.style.display = 'none'; }
    });
    // --- END: ORIGINAL SCRIPT (NO CHANGES) ---


    // --- 🚀 START: NEW LOGIC FOR STATE MANAGEMENT 🚀 ---

    const editSeatManagementLink = document.getElementById('edit-seat-management-link');

    // 1. Save form state before navigating to the seat management page
    editSeatManagementLink.addEventListener('click', function(event) {
        console.log('Edit Seat Management clicked. Saving form data...');

        const formElements = scheduleForm.elements;
        const formData = {};

        // Loop through all form elements and save their ID and value
        for (const element of formElements) {
            if (element.id) {
                formData[element.id] = element.value;
            }
        }

        // Save the form data and a flag to reopen the modal in sessionStorage
        sessionStorage.setItem('pendingScheduleEdit', JSON.stringify(formData));
        sessionStorage.setItem('shouldReopenModal', 'true');
        sessionStorage.setItem('editingScheduleId', currentScheduleId); // Also save the ID of the schedule being edited
    });


    // 2. Check on page load if we need to restore the form state
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Page loaded. Checking for pending edits...');

        const shouldReopen = sessionStorage.getItem('shouldReopenModal');

        if (shouldReopen === 'true') {
            console.log('Found pending edit. Restoring form and opening modal...');

            // Retrieve the saved form data
            const savedData = JSON.parse(sessionStorage.getItem('pendingScheduleEdit'));
            currentScheduleId = sessionStorage.getItem('editingScheduleId');
            currentAction = 'edit'; // Ensure we are in 'edit' mode

            if (savedData) {
                // Populate the form with the saved data
                for (const key in savedData) {
                    const element = document.getElementById(key);
                    if (element) {
                        element.value = savedData[key];
                    }
                }
            }

            // Re-open the modal
            modalTitle.textContent = 'Edit Schedule';
            scheduleModal.style.display = 'flex';

            // Clean up sessionStorage to prevent this from running again on refresh
            sessionStorage.removeItem('shouldReopenModal');
            sessionStorage.removeItem('pendingScheduleEdit');
            sessionStorage.removeItem('editingScheduleId');
            console.log('Cleanup complete.');
        }

        // Animate elements (existing code)
        const stats = document.querySelectorAll('.stat');
        stats.forEach((stat, index) => {
            stat.style.opacity = '0';
            stat.style.transform = 'translateY(20px)';
            setTimeout(() => {
                stat.style.opacity = '1';
                stat.style.transform = 'translateY(0)';
                stat.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            }, 200 + index * 150);
        });
    });

    // --- 🚀 END: NEW LOGIC FOR STATE MANAGEMENT 🚀 ---

    // --- 🌐 START: BACKEND INTEGRATION FOR CRUD AND LISTING ---
    document.addEventListener('DOMContentLoaded', () => {
        loadSchedules();
        loadStats();

        // Create/Update submit
        scheduleForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const payload = formToSchedulePayload();
            try {
                if (currentAction === 'edit' && currentScheduleId) {
                    await apiPut(`/api/admin/schedules/${currentScheduleId}`, payload);
                } else {
                    await apiPost('/api/admin/schedules', payload);
                }
                scheduleModal.style.display = 'none';
                await loadSchedules();
                await loadStats();
            } catch (err) {
                console.error('Save failed', err);
                alert('Failed to save schedule. Check console for details.');
            }
        });

        // Delete schedule
        document.querySelectorAll('.confirm-delete-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
                if (!currentScheduleId) return;
                try {
                    await apiDelete(`/api/admin/schedules/${currentScheduleId}`);
                    deleteModal.style.display = 'none';
                    await loadSchedules();
                    await loadStats();
                } catch (err) {
                    console.error('Delete failed', err);
                    alert('Failed to delete schedule.');
                }
            });
        });

        // Open delete modal with selected row & open edit modal with backend data
        document.addEventListener('click', (e) => {
            const delBtn = e.target.closest('.delete-btn');
            if (delBtn) {
                const row = delBtn.closest('tr');
                currentScheduleId = row?.dataset?.scheduleId;
                document.getElementById('delete-train-name').textContent = row.querySelector('.train-name')?.textContent || '';
                document.getElementById('delete-route').textContent = row.querySelector('.route')?.textContent || '';
                deleteModal.style.display = 'flex';
            }

            const editBtn = e.target.closest('.edit-btn');
            if (editBtn) {
                const row = editBtn.closest('tr');
                const id = row?.dataset?.scheduleId;
                if (!id) return;
                currentAction = 'edit';
                currentScheduleId = id;
                openEditWithData(id);
            }
        });

        // Search and filters
        document.getElementById('search-btn')?.addEventListener('click', () => applyFilters());
        document.getElementById('route-filter')?.addEventListener('change', () => applyFilters());
        document.getElementById('status-filter')?.addEventListener('change', () => applyFilters());
    });

    async function loadSchedules() {
        try {
            const data = await apiGet('/api/admin/schedules');
            renderScheduleTable(data);
        } catch (e) {
            console.error('Failed to load schedules', e);
        }
    }

    async function loadStats() {
        try {
            const stats = await apiGet('/api/admin/schedules/stats');
            const active = stats?.ACTIVE ?? 0;
            const delayed = stats?.DELAYED ?? 0;
            const canceled = stats?.CANCELED ?? 0;
            document.querySelectorAll('.stat .label').forEach((el) => {
                const label = el.textContent?.toUpperCase();
                if (label === 'ACTIVE TRAINS') el.previousElementSibling.textContent = active;
                if (label === 'DELAYED') el.previousElementSibling.textContent = delayed;
                if (label === 'CANCELED') el.previousElementSibling.textContent = canceled;
            });
        } catch (e) {
            console.error('Failed to load stats', e);
        }
    }

    function applyFilters() {
        const q = document.getElementById('search-input')?.value.trim();
        const route = document.getElementById('route-filter')?.value || '';
        const status = document.getElementById('status-filter')?.value || '';
        let routeFrom = null, routeTo = null;
        if (route && route.includes('-')) {
            const [from, to] = route.split('-');
            routeFrom = from.replace(/_/g,' ').trim();
            routeTo = to.replace(/_/g,' ').trim();
        }
        const params = new URLSearchParams();
        if (q) params.append('query', q);
        if (routeFrom) params.append('routeFrom', routeFrom);
        if (routeTo) params.append('routeTo', routeTo);
        if (status) params.append('status', status.toUpperCase());
        const url = params.toString() ? `/api/admin/schedules/search?${params.toString()}` : '/api/admin/schedules';
        apiGet(url).then(renderScheduleTable).catch(console.error);
    }

    function renderScheduleTable(items) {
        const tbody = document.getElementById('schedule-body');
        if (!tbody) return;
        tbody.innerHTML = '';
        if (!items || items.length === 0) {
            const tr = document.createElement('tr');
            const td = document.createElement('td');
            td.colSpan = 9;
            td.textContent = 'No schedules available.';
            tr.appendChild(td);
            tbody.appendChild(tr);
            return;
        }
        items.forEach(it => {
            const tr = document.createElement('tr');
            tr.dataset.scheduleId = it.id;
            tr.innerHTML = `
                <td class="train-name">${it.trainName || ''}</td>
                <td class="route">${(it.routeFrom || '')} - ${(it.routeTo || '')}</td>
                <td class="departure">${(it.departureTime || '').toString().slice(0,5)}</td>
                <td class="arrival">${(it.arrivalTime || '').toString().slice(0,5)}</td>
                <td class="duration">${it.duration || ''}</td>
                <td class="platform">${it.platform ?? ''}</td>
                <td class="status ${statusClass(it.status)}">${it.status || ''}</td>
                <td class="price">Rs.${fmt(it.economyPrice)} / Rs.${fmt(it.businessPrice)} / Rs.${fmt(it.firstPrice)}</td>
                <td class="actions">
                    <button class="edit-btn" data-action="edit" title="Edit Schedule">✏️</button>
                    <button class="delete-btn" data-action="delete" title="Delete Schedule">🗑️</button>
                </td>`;
            tbody.appendChild(tr);
        });
    }

    function fmt(v){ return (v ?? '') === '' ? '' : Number(v).toFixed(2); }
    function statusClass(s){
        const v = (s||'').toString().toUpperCase();
        if (v==='ACTIVE') return 'status-active';
        if (v==='DELAYED') return 'status-delayed';
        if (v==='CANCELED') return 'status-canceled';
        return 'status-maintenance';
    }

    function formToSchedulePayload(){
        return {
            trainName: document.getElementById('train-name').value,
            trainType: toEnum(document.getElementById('train-type').value),
            routeFrom: document.getElementById('route-from').value,
            routeTo: document.getElementById('route-to').value,
            departureTime: document.getElementById('departure-time').value+':00',
            arrivalTime: document.getElementById('arrival-time').value+':00',
            platform: Number(document.getElementById('platform').value),
            status: document.getElementById('status').value.toUpperCase(),
            economyPrice: Number(document.getElementById('economy-price').value),
            businessPrice: Number(document.getElementById('business-price').value),
            firstPrice: Number(document.getElementById('first-price').value),
            notes: document.getElementById('notes').value
        };
    }
    function toEnum(v){
        const map = { 'express':'EXPRESS','regional':'REGIONAL','commuter':'COMMUTER','high-speed':'HIGH_SPEED' };
        return map[v] || 'EXPRESS';
    }

    async function apiGet(url){ const r = await fetch(url); if(!r.ok) throw new Error(await r.text()); return r.json(); }
    async function apiPost(url, body){ const r = await fetch(url,{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)}); if(!r.ok) throw new Error(await r.text()); return r.json(); }
    async function apiPut(url, body){ const r = await fetch(url,{method:'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)}); if(!r.ok) throw new Error(await r.text()); return r.json(); }
    async function apiDelete(url){ const r = await fetch(url,{method:'DELETE'}); if(!r.ok) throw new Error(await r.text()); return true; }
    // --- 🌐 END: BACKEND INTEGRATION ---

    async function openEditWithData(id){
        try {
            const it = await apiGet(`/api/admin/schedules/${id}`);
            document.getElementById('train-name').value = it.trainName || '';
            document.getElementById('train-type').value = fromEnum(it.trainType);
            document.getElementById('route-from').value = it.routeFrom || '';
            document.getElementById('route-to').value = it.routeTo || '';
            document.getElementById('departure-time').value = (it.departureTime || '').toString().slice(0,5);
            document.getElementById('arrival-time').value = (it.arrivalTime || '').toString().slice(0,5);
            document.getElementById('platform').value = it.platform ?? '';
            document.getElementById('status').value = (it.status || 'ACTIVE').toString().toLowerCase();
            document.getElementById('economy-price').value = it.economyPrice ?? '';
            document.getElementById('business-price').value = it.businessPrice ?? '';
            document.getElementById('first-price').value = it.firstPrice ?? '';
            document.getElementById('notes').value = it.notes ?? '';
            modalTitle.textContent = 'Edit Schedule';
            scheduleModal.style.display = 'flex';
        } catch (e) {
            console.error('Failed to load schedule', e);
            alert('Failed to load schedule for editing.');
        }
    }
    function fromEnum(v){
        const map = { 'EXPRESS':'express','REGIONAL':'regional','COMMUTER':'commuter','HIGH_SPEED':'high-speed' };
        return map[v] || 'express';
    }
</script>
</body>
</html>