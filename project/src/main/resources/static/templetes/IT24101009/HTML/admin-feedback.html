<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SLRailE - Admin Feedback</title>
    <link rel="stylesheet" href="../CSS/admin-feedback.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>

<!-- Header -->
<header class="header">
    <h1><a href="index.html"> SLRailE </a></h1>
    <nav class="navigation">
        <ul>
            <li><a href="admin.html">Dashboard</a></li>
            <li><a href="../../IT24102460/HTML/admin_shedule.html">Schedule</a></li>
            <li><a href="../../IT24101525/HTML/adminseatmanegement.html">Seat Allocation</a></li>
            <li><a href="../../IT24300073/HTML/admin-profile.html">My Profile</a></li>
            <li><a href="#"class="active">Feedback</a></li>
        </ul>
    </nav>
    </div>
</header>

<!-- Main Content -->
<main class="main-content">
    <!-- Feedback Content Area -->
    <section class="content-area">
        <h1>Passenger Feedbacks</h1>
        <p class="description">View and manage all passenger feedback submitted through the system.</p>

        <!-- Feedback Table -->
        <table class="feedback-table">
            <thead>
            <tr>
                <th>ID</th>
                <th>Passenger Name</th>
                <th>Email</th>
                <th>Rating</th>
                <th>Feedback Message</th>
                <th>Date & Time</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <!-- Feedback rows will be populated by JavaScript -->
            </tbody>
        </table>
    </section>
</main>

<footer class="footer">
    <div class="footer-content">
        <div class="footer-logo">
            <h3>SLRailE</h3>
            <p>SLRailE is your all-in-one digital companion for train travel across Sri Lanka. Designed to make journeys smoother and more convenient, SLRailE provides real-time train schedules, route planning, and live updates on arrivals, departures, and delays.</p>
            <p>Whether you're a daily commuter or a tourist exploring the island's breathtaking scenery, SLRailE is your essential partner for smart and seamless railway travel.</p>
        </div>
        <div class="footer-links">
            <div class="link-column">
                <h4>Admin Tools</h4>
                <ul>
                    <li><a href="#">Dashboard</a></li>
                    <li><a href="#">Schedule</a></li>
                    <li><a href="#">Feedback</a></li>
                    <li><a href="#">Seat Allocation</a></li>
                    <li><a href="#">Profile</a></li>
                </ul>
            </div>
            <div class="link-column">
                <h4>Information</h4>
                <ul>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Careers</a></li>
                    <li><a href="#">News</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
            </div>
            <div class="link-column">
                <h4>Legal</h4>
                <ul>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms of Service</a></li>
                    <li><a href="#">Cookie Policy</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="copyright">
        <p>&copy; 2025 SLRailE. All rights reserved.</p>
    </div>
</footer>

<script>
    async function fetchFeedbacks() {
        try {
            const response = await fetch('/api/feedback');
            const feedbacks = await response.json();

            const tbody = document.querySelector('.feedback-table tbody');
            tbody.innerHTML = '';

            feedbacks.forEach(feedback => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${feedback.id}</td>
                    <td>${feedback.passengerName}</td>
                    <td>${feedback.email}</td>
                    <td>${'‚≠ê'.repeat(feedback.rating)}</td>
                    <td>${feedback.message}</td>
                    <td>${new Date(feedback.dateTime).toLocaleString()}</td>
                    <td><button class="btn-delete" onclick="deleteFeedback(${feedback.id})">Delete</button></td>
                `;
                tbody.appendChild(row);
            });
        } catch (error) {
            console.error('Error fetching feedbacks:', error);
        }
    }

    async function deleteFeedback(id) {
        if (!confirm('Are you sure you want to delete this feedback?')) return;

        try {
            const response = await fetch(`/api/feedback/${id}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                alert('Feedback deleted successfully!');
                fetchFeedbacks();
            } else {
                alert('Failed to delete feedback. Please try again.');
            }
        } catch (error) {
            console.error('Error deleting feedback:', error);
        }
    }

    document.addEventListener('DOMContentLoaded', fetchFeedbacks);
</script>

</body>
</html>